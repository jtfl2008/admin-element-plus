# 实现计划：岗位管理

## 概述

本实现计划将岗位管理模块的设计转化为具体的编码任务。每个任务都是离散的、可管理的步骤，按照依赖关系组织，确保增量式开发和持续验证。

## 任务列表

- [x] 1. 扩展类型定义
  - 在 `src/typings/api/system.d.ts` 中添加岗位相关的类型定义
  - 添加 `PostSearchParams` 接口（查询参数）
  - 添加 `PostOperateParams` 接口（操作参数）
  - 扩展 `Post` 接口，添加 `deptId`、`deptName`、`postCategory`、`tenantId` 等字段
  - _需求: 10.1, 10.2_

- [x] 2. 实现 API 接口层
  - [x] 2.1 创建岗位 API 文件
    - 创建 `src/service/api/system/post.ts` 文件
    - 实现 `fetchGetPostList` 函数（获取岗位列表）
    - 实现 `fetchGetPostDetail` 函数（获取岗位详情）
    - 实现 `fetchCreatePost` 函数（新增岗位）
    - 实现 `fetchUpdatePost` 函数（更新岗位）
    - 实现 `fetchDeletePost` 函数（删除岗位）
    - 实现 `fetchBatchDeletePost` 函数（批量删除岗位）
    - 实现 `fetchExportPost` 函数（导出岗位）
    - _需求: 1.1, 2.1, 3.1, 4.1, 7.1_

- [x] 3. 实现主页面组件
  - [x] 3.1 创建页面文件和基础结构
    - 创建 `src/views/system/post/index.vue` 文件
    - 设置页面基础布局（查询区域 + 表格区域）
    - 导入必要的组件和工具函数
    - _需求: 1.1_
  
  - [x] 3.2 实现查询表单功能
    - 配置查询表单字段（岗位编码、岗位名称、状态、归属部门）
    - 实现查询按钮功能
    - 实现重置按钮功能
    - 集成部门树选择器
    - _需求: 1.2, 6.4_
  
  - [x] 3.3 实现数据表格功能
    - 配置表格列（岗位编码、岗位名称、类别编码、归属部门、显示顺序、状态、创建时间、备注）
    - 实现分页功能
    - 实现表格数据加载
    - 实现表格选择功能
    - _需求: 1.1, 1.3_
  
  - [x] 3.4 实现工具栏功能
    - 添加新增按钮（带权限控制）
    - 添加批量删除按钮（带权限控制）
    - 添加导出按钮（带权限控制）
    - _需求: 2.1, 4.3, 7.1_
  
  - [x] 3.5 实现操作列功能
    - 添加编辑按钮（带权限控制）
    - 添加删除按钮（带权限控制）
    - _需求: 3.1, 4.1_

- [x] 4. 实现新增/编辑对话框
  - [x] 4.1 实现对话框状态管理
    - 定义对话框显示状态
    - 定义对话框类型（新增/编辑）
    - 定义对话框加载状态
    - 定义表单数据结构
    - _需求: 2.1, 3.1_
  
  - [x] 4.2 配置对话框表单
    - 配置表单字段（归属部门、岗位编码、类别编码、岗位名称、显示顺序、状态、备注）
    - 配置表单验证规则
    - 集成 DialogForm 组件
    - _需求: 2.2, 3.2, 8.1, 8.2, 8.3, 8.4, 8.5_
  
  - [x] 4.3 实现对话框操作方法
    - 实现打开新增对话框方法
    - 实现打开编辑对话框方法（加载岗位详情）
    - 实现提交对话框方法（新增/编辑）
    - 实现取消对话框方法
    - 实现重置表单方法
    - _需求: 2.3, 2.5, 3.3, 3.5_

- [x] 5. 实现删除功能
  - [x] 5.1 实现单个删除
    - 添加删除确认对话框
    - 调用删除 API
    - 显示成功/失败提示
    - 刷新表格数据
    - _需求: 4.2, 4.5_
  
  - [x] 5.2 实现批量删除
    - 检查是否选中数据
    - 添加批量删除确认对话框
    - 调用批量删除 API
    - 显示成功/失败提示
    - 刷新表格数据
    - _需求: 4.4, 4.5_

- [x] 6. 实现导出功能
  - 构建导出参数（包含当前查询条件）
  - 调用导出 API
  - 处理 Blob 响应
  - 创建下载链接并触发下载
  - 显示成功/失败提示
  - _需求: 7.1, 7.2, 7.3_

- [x] 7. 实现错误处理
  - [x] 7.1 实现表单验证错误处理
    - 在提交前进行表单验证
    - 显示验证错误提示
    - _需求: 2.4, 3.4, 8.6_
  
  - [x] 7.2 实现 API 调用错误处理
    - 捕获 API 调用异常
    - 显示友好的错误提示
    - 处理常见业务错误（岗位编码重复、岗位被引用等）
    - _需求: 2.4, 3.4, 4.2, 4.4_

- [x] 8. 添加权限控制
  - 为新增按钮添加权限检查（system:post:add）
  - 为编辑按钮添加权限检查（system:post:edit）
  - 为删除按钮添加权限检查（system:post:remove）
  - 为批量删除按钮添加权限检查（system:post:remove）
  - 为导出按钮添加权限检查（system:post:export）
  - _需求: 2.1, 3.1, 4.1, 4.3, 7.1_

- [x] 9. 优化性能
  - [x] 9.1 实现搜索防抖
    - 为搜索输入添加防抖处理（500ms）
    - _需求: 1.2_
  
  - [x] 9.2 实现请求缓存
    - 缓存部门树数据
    - 避免重复请求
    - _需求: 6.3_

- [x] 10. 最终检查点
  - 确保所有功能正常工作
  - 确保所有必填字段验证生效
  - 确保权限控制正确
  - 确保错误处理完善
  - 确保用户体验流畅
  - 询问用户是否有问题

## 注意事项

1. **任务顺序**: 按照任务编号顺序执行，确保依赖关系正确
2. **增量开发**: 每完成一个任务，确保代码可以编译和运行
3. **测试验证**: 在关键节点进行功能测试
4. **代码规范**: 遵循项目现有的代码规范和命名约定
5. **错误处理**: 所有 API 调用都要有完善的错误处理
6. **权限控制**: 所有操作按钮都要进行权限检查
7. **用户体验**: 提供清晰的加载状态和操作反馈
