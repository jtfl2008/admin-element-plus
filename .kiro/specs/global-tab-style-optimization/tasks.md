# 实现计划：全局标签页样式系统优化

## 概述

本实现计划将全局标签页组件的样式系统优化分解为一系列可执行的任务。通过创建主题配置系统、CSS 变量系统和样式文件，实现三种主题（卡片、按钮、下划线）的支持，并确保浅色/深色模式的自动适配。

## 任务列表

- [ ] 1. 创建主题配置系统
  - [x] 1.1 创建主题配置类型定义
    - 创建 `src/layouts/modules/global-tab/config/tab-themes.ts` 文件
    - 定义 `TabThemeConfig`、`TabThemeColors`、`TabThemeType` 接口
    - 添加完整的 JSDoc 注释说明每个属性的用途
    - _需求：1.1, 1.5_

  - [x] 1.2 实现三种内置主题配置
    - 在 `tab-themes.ts` 中实现 `cardTheme` 配置对象
    - 在 `tab-themes.ts` 中实现 `buttonTheme` 配置对象
    - 在 `tab-themes.ts` 中实现 `underlineTheme` 配置对象
    - 每个主题包含 light 和 dark 两种模式的完整配置
    - _需求：1.2, 1.3, 1.4_

  - [x] 1.3 实现主题映射和获取函数
    - 创建 `themeMap` 对象，映射主题名称到配置
    - 实现 `getThemeConfig` 函数，支持自定义配置合并
    - 添加无效主题类型的回退逻辑
    - _需求：1.2, 3.4, 12.1_

- [ ] 2. 创建 CSS 变量系统
  - [x] 2.1 创建样式变量定义文件
    - 创建 `src/layouts/modules/global-tab/styles/_variables.scss` 文件
    - 定义所有主题相关的 CSS 变量（使用 `--tab-theme-*` 前缀）
    - 添加文件头注释说明变量用途和命名规范
    - _需求：2.1, 2.2, 2.5_

  - [x] 2.2 创建样式目录和入口文件
    - 创建 `src/layouts/modules/global-tab/styles/` 目录
    - 创建 `styles/index.scss` 作为样式入口文件
    - 导入 `_variables.scss` 和后续的主题样式文件
    - _需求：4.1, 4.5_

- [ ] 3. 实现主题样式文件
  - [x] 3.1 创建卡片主题样式
    - 创建 `src/layouts/modules/global-tab/styles/_card.scss` 文件
    - 实现 `.theme-card` 类的样式规则
    - 使用 CSS 变量定义所有颜色和布局属性
    - 实现活动状态、悬停状态的样式
    - 添加阴影效果和圆角设计
    - _需求：4.2, 5.1, 5.2, 5.3, 5.4, 5.5_

  - [x] 3.2 创建按钮主题样式
    - 创建 `src/layouts/modules/global-tab/styles/_button.scss` 文件
    - 实现 `.theme-button` 类的样式规则
    - 使用 CSS 变量定义所有颜色和布局属性
    - 实现紧凑的内边距和较小的圆角
    - 实现按钮风格的活动状态和悬停效果
    - _需求：4.3, 6.1, 6.2, 6.3, 6.4, 6.5_

  - [x] 3.3 创建下划线主题样式
    - 创建 `src/layouts/modules/global-tab/styles/_underline.scss` 文件
    - 实现 `.theme-underline` 类的样式规则
    - 使用透明背景和下划线效果
    - 实现活动状态的下划线显示（使用 `::before` 或 `::after` 伪元素）
    - 实现悬停状态的文字颜色变化
    - _需求：4.4, 7.1, 7.2, 7.3, 7.4, 7.5_

  - [x] 3.4 更新样式入口文件
    - 在 `styles/index.scss` 中导入所有主题样式文件
    - 确保样式加载顺序正确
    - 添加注释说明每个主题的特点
    - _需求：4.5, 4.6_

- [ ] 4. 扩展主组件功能
  - [x] 4.1 添加主题相关的 Props
    - 在 `src/layouts/modules/global-tab/index.vue` 中添加 `theme` prop
    - 添加 `themeConfig` prop 用于自定义配置
    - 设置默认值 `theme: 'card'`
    - 添加完整的 JSDoc 注释
    - _需求：3.1, 3.2, 3.5_

  - [x] 4.2 实现主题应用逻辑
    - 导入 `getThemeConfig` 函数和主题类型
    - 创建 `currentThemeConfig` 计算属性
    - 创建 `isDarkMode` 计算属性（从 appStore 获取）
    - 创建 `currentColors` 计算属性（根据模式选择配置）
    - _需求：3.3, 8.1, 8.2_

  - [x] 4.3 实现 CSS 变量动态更新
    - 实现 `applyTheme` 函数，更新所有 CSS 变量
    - 使用 `watch` 监听 `currentColors` 变化
    - 在 `onMounted` 钩子中初始化主题
    - 添加错误处理和回退逻辑
    - _需求：2.3, 2.4, 11.1, 11.2_

  - [x] 4.4 应用主题类名到组件
    - 在组件根元素添加动态类名（如 `:class="'theme-' + theme"`）
    - 确保类名切换不触发组件重新渲染
    - 导入并应用主题样式文件
    - _需求：4.6, 11.2_

- [ ] 5. 更新子组件样式
  - [x] 5.1 更新 TabItem 组件样式
    - 修改 `src/layouts/modules/global-tab/components/tab-item.vue` 的样式
    - 将硬编码的颜色值替换为 CSS 变量
    - 确保所有状态（默认、活动、悬停、拖拽）使用主题变量
    - 保持现有的交互功能不变
    - _需求：9.1, 9.2, 9.4_

  - [x] 5.2 确保右键菜单样式兼容
    - 检查 `src/layouts/modules/global-tab/components/context-menu.vue`
    - 确保菜单样式不受主题切换影响
    - 验证右键菜单功能正常工作
    - _需求：9.3_

- [ ] 6. 实现浅色/深色模式支持
  - [ ] 6.1 添加模式检测逻辑
    - 在主组件中添加 `isDarkMode` 计算属性
    - 从 appStore 或系统设置获取当前模式
    - 确保模式变化时自动更新主题颜色
    - _需求：8.1, 8.2, 8.5_

  - [ ] 6.2 实现平滑过渡效果
    - 在 CSS 变量更新时添加过渡效果
    - 设置合适的过渡时间（建议 300ms）
    - 确保过渡不影响性能
    - _需求：8.3, 11.3_

  - [ ] 6.3 验证对比度和可读性
    - 测试所有主题在两种模式下的显示效果
    - 确保文字和背景有足够的对比度
    - 调整颜色值以满足可访问性标准
    - _需求：8.4_

- [ ] 7. 性能优化
  - [ ] 7.1 优化 CSS 变量更新
    - 批量更新 CSS 变量，减少重绘次数
    - 使用 `requestAnimationFrame` 优化更新时机
    - 确保更新时间在 100ms 以内
    - _需求：11.1_

  - [ ] 7.2 避免不必要的重新渲染
    - 使用 `computed` 而非 `watch` 处理派生状态
    - 确保主题切换不触发组件重新渲染
    - 使用 `shallowRef` 优化大对象的响应式处理
    - _需求：11.2_

  - [ ] 7.3 优化 CSS 选择器
    - 检查所有样式文件的选择器效率
    - 避免过度嵌套（最多 3 层）
    - 使用类选择器而非标签选择器
    - _需求：11.5_

- [ ] 8. 添加代码注释和文档
  - [ ] 8.1 完善主题配置注释
    - 为每个主题配置对象添加详细注释
    - 说明每个颜色值的用途和设计意图
    - 添加使用示例
    - _需求：10.1_

  - [ ] 8.2 完善组件 Props 注释
    - 为 `theme` 和 `themeConfig` props 添加 JSDoc 注释
    - 说明可选值和默认行为
    - 添加使用示例
    - _需求：10.2_

  - [ ] 8.3 完善样式文件注释
    - 为每个样式文件添加文件头注释
    - 说明主题的视觉特点和适用场景
    - 为关键样式规则添加行内注释
    - _需求：10.3, 10.4_

  - [ ] 8.4 确保代码规范
    - 运行 ESLint 和 Prettier 检查代码格式
    - 确保所有代码符合项目编码规范
    - 修复所有 lint 警告和错误
    - _需求：10.5_

- [ ] 9. 测试和验证
  - [ ] 9.1 测试主题切换功能
    - 测试在三种主题之间切换
    - 验证 CSS 变量正确更新
    - 验证视觉效果符合设计要求
    - _需求：3.3, 4.6_

  - [ ] 9.2 测试浅色/深色模式切换
    - 测试模式切换时颜色变化
    - 验证过渡效果平滑
    - 验证对比度和可读性
    - _需求：8.1, 8.2, 8.3, 8.4_

  - [ ] 9.3 测试自定义主题配置
    - 测试通过 `themeConfig` prop 自定义主题
    - 验证配置合并逻辑正确
    - 测试部分配置覆盖
    - _需求：3.4, 12.2_

  - [ ] 9.4 测试交互功能
    - 测试标签页点击切换功能
    - 测试标签页关闭功能
    - 测试右键菜单功能
    - 测试拖拽排序功能
    - 测试滚动按钮功能
    - _需求：9.1, 9.2, 9.3, 9.4, 9.5_

  - [ ] 9.5 性能测试
    - 测试主题切换的响应时间
    - 测试大量标签页时的性能
    - 使用浏览器开发工具分析性能
    - _需求：11.1, 11.4_

- [ ] 10. 最终检查点
  - 确保所有测试通过
  - 确保代码注释完整
  - 确保符合项目编码规范
  - 如有问题，请向用户反馈

## 注意事项

- 所有任务应按顺序执行，确保依赖关系正确
- 每个任务完成后应进行基本的功能验证
- 遇到问题时及时向用户反馈
- 保持代码的可读性和可维护性
- 确保向后兼容性，不破坏现有功能
