# 实施计划：工作台

## 概述

本实施计划将工作台功能分解为可执行的开发任务。采用增量开发方式，每个任务都建立在前面任务的基础上，确保代码逐步集成。重点关注核心功能实现，测试任务标记为可选，以便快速构建 MVP。

## 任务列表

- [x] 1. 搭建工作台基础结构
  - 创建工作台页面目录结构 `src/views/workbench/`
  - 创建主页面组件 `src/views/workbench/index.vue`
  - 创建组件目录 `src/views/workbench/components/`
  - 配置工作台路由
  - _需求：需求 1.1, 6.1, 6.2, 6.3_

- [ ] 2. 实现 Pinia Store 状态管理
  - [x] 2.1 创建工作台 Store
    - 创建 `src/stores/modules/workbench.ts`
    - 定义 WorkbenchState 接口和初始状态
    - 实现数据获取 action (fetchData)
    - 实现数据刷新 action (refreshData)
    - 实现布局配置管理 actions
    - _需求：需求 7.1, 7.2, 7.3, 5.3, 5.4_

  - [ ]* 2.2 编写 Store 单元测试
    - 测试数据获取和更新逻辑
    - 测试布局配置保存和恢复
    - 测试 getters 计算逻辑
    - _需求：需求 7.1, 5.3, 5.4_

- [ ] 3. 实现数据卡片组件
  - [x] 3.1 创建数据卡片组件
    - 创建 `src/views/workbench/components/data-card.vue`
    - 实现 DataCardProps 接口
    - 实现数据展示（标题、数值、单位）
    - 实现趋势指示器（上升/下降/稳定）
    - 实现加载和错误状态
    - 实现点击事件处理
    - 支持响应式布局
    - _需求：需求 1.1, 1.2, 1.4, 1.5, 6.4_

  - [ ]* 3.2 编写数据卡片单元测试
    - 测试不同 props 的渲染结果
    - 测试趋势指示器显示逻辑
    - 测试点击事件触发
    - 测试加载和错误状态
    - _需求：需求 1.2, 1.4_

  - [ ]* 3.3 编写属性测试：数据卡片加载状态一致性
    - **属性 1：数据卡片加载状态一致性**
    - **验证需求：需求 1.2**
    - 生成随机加载状态，验证所有卡片都有明确状态
    - _需求：需求 1.2_

- [ ] 4. 实现快捷操作组件
  - [x] 4.1 创建快捷操作组件
    - 创建 `src/views/workbench/components/quick-actions.vue`
    - 实现 QuickAction 接口定义
    - 实现操作列表展示（图标、标题、描述）
    - 实现权限过滤逻辑
    - 实现路由跳转和自定义操作
    - 支持响应式列数调整
    - _需求：需求 2.1, 2.2, 2.3, 2.4, 2.5, 6.4_

  - [ ]* 4.2 编写快捷操作单元测试
    - 测试权限过滤逻辑
    - 测试路由跳转
    - 测试自定义操作执行
    - _需求：需求 2.3, 2.5_

  - [ ]* 4.3 编写属性测试：快捷操作权限过滤
    - **属性 2：快捷操作权限过滤**
    - **验证需求：需求 2.5**
    - 生成随机权限配置，验证快捷操作过滤正确
    - _需求：需求 2.5_

- [ ] 5. 实现统计图表组件
  - [x] 5.1 创建图表卡片组件
    - 创建 `src/views/workbench/components/chart-card.vue`
    - 集成 ECharts 库
    - 实现 ChartCardProps 和 ChartData 接口
    - 实现折线图、柱状图、饼图、面积图渲染
    - 实现时间范围筛选器（今日、本周、本月、自定义）
    - 实现图表响应式调整
    - 实现主题切换支持
    - 实现加载状态
    - _需求：需求 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 10.3_

  - [ ]* 5.2 编写图表组件单元测试
    - 测试不同图表类型渲染
    - 测试时间范围筛选
    - 测试主题切换
    - _需求：需求 3.2, 3.4, 10.3_

  - [ ]* 5.3 编写属性测试：图表响应式布局
    - **属性 3：图表响应式布局**
    - **验证需求：需求 3.6**
    - 生成随机屏幕尺寸，验证图表响应式调整
    - _需求：需求 3.6_

- [ ] 6. 检查点 - 确保核心组件测试通过
  - 确保所有测试通过，如有问题请询问用户

- [ ] 7. 实现活动列表组件
  - [x] 7.1 创建活动列表组件
    - 创建 `src/views/workbench/components/activity-list.vue`
    - 实现 Activity 接口定义
    - 实现活动记录列表展示
    - 实现时间格式化显示
    - 实现活动类型图标映射
    - 支持最大条目数限制
    - _需求：需求 4.1, 4.2_

  - [ ]* 7.2 编写活动列表单元测试
    - 测试活动记录展示
    - 测试时间格式化
    - 测试最大条目数限制
    - _需求：需求 4.1, 4.2_

- [ ] 8. 实现通知卡片组件
  - [x] 8.1 创建通知卡片组件
    - 创建 `src/views/workbench/components/notification-card.vue`
    - 实现 Notification 接口定义
    - 实现通知列表展示
    - 实现已读/未读状态显示
    - 实现按优先级排序
    - 实现标记已读功能
    - 实现通知点击事件
    - _需求：需求 4.3, 4.4, 4.5_

  - [ ]* 8.2 编写通知卡片单元测试
    - 测试通知展示
    - 测试优先级排序
    - 测试已读状态切换
    - _需求：需求 4.4, 4.5_

  - [ ]* 8.3 编写属性测试：通知已读状态同步
    - **属性 9：通知已读状态同步**
    - **验证需求：需求 4.5**
    - 生成随机通知操作序列，验证状态同步
    - _需求：需求 4.5_

- [ ] 9. 实现布局配置功能
  - [ ] 9.1 集成 vue-grid-layout
    - 安装 vue-grid-layout 依赖
    - 创建 `src/views/workbench/components/layout-config.vue`
    - 实现 LayoutItem 和 LayoutConfig 接口
    - 实现拖拽布局功能
    - 实现组件显示/隐藏控制
    - 实现布局配置持久化（localStorage）
    - 实现恢复默认布局功能
    - _需求：需求 5.1, 5.2, 5.3, 5.4, 5.5_

  - [ ]* 9.2 编写属性测试：布局配置持久化
    - **属性 4：布局配置持久化**
    - **验证需求：需求 5.4**
    - 生成随机布局配置，验证持久化和恢复
    - _需求：需求 5.4_

  - [ ]* 9.3 编写属性测试：组件可见性控制
    - **属性 10：组件可见性控制**
    - **验证需求：需求 5.2**
    - 生成随机可见性配置，验证组件渲染控制
    - _需求：需求 5.2_

- [ ] 10. 实现 API 服务层
  - [x] 10.1 创建工作台 API 接口
    - 创建 `src/service/api/workbench.ts`
    - 定义 API 接口类型
    - 实现统计数据获取接口
    - 实现活动记录获取接口
    - 实现通知获取接口
    - 实现错误处理
    - _需求：需求 1.2, 4.1, 4.3, 9.1_

  - [ ]* 10.2 编写 API 服务单元测试
    - 测试接口调用
    - 测试错误处理
    - 测试数据格式验证
    - _需求：需求 9.1, 9.2_

- [ ] 11. 集成所有组件到工作台主页面
  - [ ] 11.1 组装工作台页面
    - 在 `src/views/workbench/index.vue` 中集成所有子组件
    - 实现数据卡片区域（至少 4 个卡片）
    - 实现快捷操作区域（至少 6 个操作）
    - 实现图表区域（至少 2 个图表）
    - 实现活动和通知区域
    - 连接 Pinia Store
    - 实现页面加载逻辑
    - 实现数据刷新逻辑
    - _需求：需求 1.1, 2.1, 3.1, 4.1, 7.1, 7.2_

  - [ ] 11.2 实现响应式布局
    - 实现桌面端多列布局（≥1200px）
    - 实现平板端双列布局（768px-1199px）
    - 实现移动端单列布局（<768px）
    - 实现屏幕尺寸变化监听
    - _需求：需求 6.1, 6.2, 6.3, 6.4_

  - [ ]* 11.3 编写属性测试：响应式列数适配
    - **属性 8：响应式列数适配**
    - **验证需求：需求 6.1, 6.2, 6.3**
    - 生成随机屏幕宽度，验证列数适配
    - _需求：需求 6.1, 6.2, 6.3_

- [ ] 12. 实现主题适配
  - [x] 12.1 实现主题切换支持
    - 为所有组件添加主题样式变量
    - 实现图表主题配置
    - 实现主题切换监听
    - 确保与全局主题设置同步
    - _需求：需求 10.1, 10.2, 10.3, 10.4, 10.5_

  - [ ]* 12.2 编写属性测试：主题切换一致性
    - **属性 5：主题切换一致性**
    - **验证需求：需求 10.2, 10.3**
    - 生成随机主题切换序列，验证样式一致性
    - _需求：需求 10.2, 10.3_

- [ ] 13. 实现性能优化
  - [ ] 13.1 优化加载性能
    - 实现骨架屏组件（复用 `src/components/common/loading-skeleton.vue`）
    - 实现图表组件懒加载
    - 实现数据缓存机制
    - 优化首屏渲染时间
    - _需求：需求 8.1, 8.2, 8.3, 8.5_

  - [x] 13.2 实现自动刷新功能
    - 在 Store 中实现自动刷新逻辑
    - 实现刷新间隔配置
    - 实现刷新开关控制
    - 实现刷新加载指示器
    - _需求：需求 7.4, 7.5_

  - [ ]* 13.3 编写属性测试：数据刷新幂等性
    - **属性 6：数据刷新幂等性**
    - **验证需求：需求 7.3**
    - 生成随机数据状态，验证刷新幂等性
    - _需求：需求 7.3_

- [ ] 14. 实现错误处理
  - [ ] 14.1 实现错误处理组件
    - 创建错误提示组件
    - 实现网络错误处理
    - 实现数据格式错误处理
    - 实现权限错误处理
    - 实现图表渲染错误处理
    - 实现重试功能
    - _需求：需求 1.3, 9.1, 9.2, 9.3, 9.4, 9.5_

  - [ ]* 14.2 编写属性测试：错误重试恢复
    - **属性 7：错误重试恢复**
    - **验证需求：需求 9.3**
    - 生成随机错误场景，验证重试恢复
    - _需求：需求 9.3_

- [ ] 15. 检查点 - 完整功能测试
  - 确保所有测试通过，如有问题请询问用户

- [ ]* 16. 集成测试
  - [ ]* 16.1 编写完整工作流集成测试
    - 测试页面加载到数据展示的完整流程
    - 测试用户交互（点击、拖拽、筛选）
    - 测试数据刷新流程
    - _需求：需求 7.1, 7.2, 7.3_

  - [ ]* 16.2 编写跨组件交互测试
    - 测试布局配置对所有组件的影响
    - 测试主题切换对所有组件的影响
    - 测试权限变化对组件显示的影响
    - _需求：需求 5.1, 10.2, 2.5_

## 注意事项

- 标记 `*` 的任务为可选任务，可以跳过以加快 MVP 开发
- 每个任务都引用了具体的需求编号，确保可追溯性
- 检查点任务用于确保增量验证
- 属性测试使用 fast-check 库，每个测试至少运行 100 次迭代
- 单元测试使用 Vitest 框架
- 所有组件都需要支持响应式布局和主题切换
