# 需求文档: 用户管理模块

## 概述

用户管理模块是系统管理的核心功能之一，提供完整的用户增删改查、状态管理、密码重置、角色分配、岗位分配等功能。本模块参考 ruoyi-plus-soybean 项目实现，采用 Element Plus 组件库。

## 用户故事

### 用户故事 1: 用户列表查看
作为系统管理员，我希望能够查看所有用户的列表，以便了解系统中的用户情况。

**验收标准:**
- 1.1 页面采用左右分栏布局，左侧显示部门树，右侧显示用户列表
- 1.2 用户列表以表格形式展示，包含：用户账号、用户昵称、部门名称、手机号码、状态、创建时间
- 1.3 表格支持多选功能，用于批量操作
- 1.4 表格支持分页，默认每页显示 10 条
- 1.5 表格支持序号列显示
- 1.6 状态列使用开关组件，可直接切换用户状态

### 用户故事 2: 用户搜索筛选
作为系统管理员，我希望能够通过多种条件搜索用户，以便快速找到目标用户。

**验收标准:**
- 2.1 支持按用户账号模糊搜索
- 2.2 支持按用户昵称模糊搜索
- 2.3 支持按手机号码模糊搜索
- 2.4 支持按用户状态筛选（正常/停用）
- 2.5 点击左侧部门树节点可筛选该部门下的用户
- 2.6 部门树支持关键字搜索过滤
- 2.7 提供重置按钮清空所有搜索条件
- 2.8 提供刷新按钮重新加载数据

### 用户故事 3: 新增用户
作为系统管理员，我希望能够新增用户，以便为新员工创建系统账号。

**验收标准:**
- 3.1 点击新增按钮打开用户表单抽屉
- 3.2 表单包含以下必填字段：用户昵称、用户账号、密码、状态
- 3.3 表单包含以下可选字段：部门、手机号码、邮箱、性别、岗位、角色、备注
- 3.4 用户账号不能重复
- 3.5 密码需符合安全规则（长度、复杂度）
- 3.6 手机号码需符合格式验证
- 3.7 邮箱需符合格式验证
- 3.8 部门选择使用树形选择器
- 3.9 岗位选择支持多选
- 3.10 角色选择支持多选
- 3.11 性别使用字典单选（男/女/未知）
- 3.12 状态使用字典单选（正常/停用）
- 3.13 提交成功后关闭抽屉并刷新列表

### 用户故事 4: 编辑用户
作为系统管理员，我希望能够编辑用户信息，以便更新用户资料。

**验收标准:**
- 4.1 点击编辑按钮打开用户表单抽屉，并回显当前用户信息
- 4.2 编辑时用户账号字段不可修改
- 4.3 编辑时密码字段隐藏（通过重置密码功能修改）
- 4.4 其他字段可正常编辑
- 4.5 提交成功后关闭抽屉并刷新列表

### 用户故事 5: 删除用户
作为系统管理员，我希望能够删除用户，以便移除离职员工的账号。

**验收标准:**
- 5.1 支持单条删除，点击删除按钮弹出确认对话框
- 5.2 支持批量删除，选中多条记录后点击批量删除按钮
- 5.3 删除前需二次确认
- 5.4 超级管理员（userId=1）不可删除
- 5.5 删除成功后刷新列表

### 用户故事 6: 重置密码
作为系统管理员，我希望能够重置用户密码，以便帮助忘记密码的用户。

**验收标准:**
- 6.1 点击重置密码按钮打开密码重置抽屉
- 6.2 显示当前用户的账号（只读）
- 6.3 输入新密码，需符合密码安全规则
- 6.4 确认新密码，需与新密码一致
- 6.5 提交成功后关闭抽屉并提示成功

### 用户故事 7: 用户状态切换
作为系统管理员，我希望能够快速切换用户状态，以便启用或禁用用户账号。

**验收标准:**
- 7.1 在用户列表的状态列显示开关组件
- 7.2 点击开关可切换用户状态（正常/停用）
- 7.3 切换前弹出确认对话框
- 7.4 超级管理员（userId=1）的状态开关禁用
- 7.5 切换成功后显示成功提示

### 用户故事 8: 用户导入导出
作为系统管理员，我希望能够批量导入导出用户，以便进行数据迁移。

**验收标准:**
- 8.1 提供导出按钮，可导出当前筛选条件下的用户数据
- 8.2 导出格式为 Excel
- 8.3 提供导入按钮，可批量导入用户数据
- 8.4 提供导入模板下载功能
- 8.5 导入时显示进度和结果

## 功能需求

### 9. 部门树组件
- 9.1 从 API 获取部门树数据
- 9.2 支持树形结构展示
- 9.3 支持节点展开/折叠
- 9.4 支持关键字搜索过滤
- 9.5 支持节点点击选中
- 9.6 选中节点后筛选对应部门的用户
- 9.7 提供刷新按钮重新加载部门树

### 10. 用户表单组件
- 10.1 使用抽屉（Drawer）形式展示
- 10.2 支持新增和编辑两种模式
- 10.3 表单字段根据模式动态显示/隐藏
- 10.4 表单验证规则完整
- 10.5 部门选择使用树形选择器组件
- 10.6 岗位选择从 API 获取选项
- 10.7 角色选择从 API 获取选项
- 10.8 性别和状态使用字典组件

### 11. 状态切换组件
- 11.1 封装通用的状态切换组件 StatusSwitch
- 11.2 支持自定义启用/禁用值
- 11.3 支持切换前确认
- 11.4 支持禁用状态
- 11.5 支持加载状态

### 12. API 接口
- 12.1 获取用户列表 `fetchGetUserList`
- 12.2 获取部门树 `fetchGetDeptTree`
- 12.3 新增用户 `fetchCreateUser`
- 12.4 更新用户 `fetchUpdateUser`
- 12.5 删除用户 `fetchBatchDeleteUser`
- 12.6 获取用户详情 `fetchGetUserInfo`
- 12.7 重置用户密码 `fetchResetUserPassword`
- 12.8 更新用户状态 `fetchUpdateUserStatus`
- 12.9 获取岗位列表 `fetchGetPostList`
- 12.10 获取角色列表 `fetchGetRoleList`
- 12.11 导出用户 `fetchExportUser`
- 12.12 导入用户 `fetchImportUser`

### 13. 权限控制
- 13.1 新增用户按钮需要 `system:user:add` 权限
- 13.2 编辑用户按钮需要 `system:user:edit` 权限
- 13.3 删除用户按钮需要 `system:user:remove` 权限
- 13.4 重置密码按钮需要 `system:user:resetPwd` 权限
- 13.5 导出按钮需要 `system:user:export` 权限
- 13.6 导入按钮需要 `system:user:import` 权限

## 非功能需求

### 14. 性能要求
- 14.1 用户列表加载时间不超过 2 秒
- 14.2 部门树支持大数据量（1000+ 节点）
- 14.3 表格支持虚拟滚动（可选）

### 15. 用户体验
- 15.1 操作成功/失败有明确的提示信息
- 15.2 表单验证错误有明确的提示
- 15.3 删除等危险操作有二次确认
- 15.4 加载状态有 loading 提示

## 数据模型

### 用户实体 (User)
```typescript
interface User {
  userId: number           // 用户ID
  userName: string         // 用户账号
  nickName: string         // 用户昵称
  deptId: number          // 部门ID
  deptName?: string       // 部门名称
  phonenumber?: string    // 手机号码
  email?: string          // 邮箱
  sex: string             // 性别（0=男, 1=女, 2=未知）
  avatar?: string         // 头像
  status: string          // 状态（0=正常, 1=停用）
  postIds?: number[]      // 岗位ID列表
  roleIds?: number[]      // 角色ID列表
  remark?: string         // 备注
  createTime?: string     // 创建时间
}
```

### 部门实体 (Dept)
```typescript
interface DeptTree {
  id: number              // 部门ID
  label: string           // 部门名称
  children?: DeptTree[]   // 子部门
}
```

### 搜索参数 (UserSearchParams)
```typescript
interface UserSearchParams {
  userName?: string       // 用户账号
  nickName?: string       // 用户昵称
  phonenumber?: string    // 手机号码
  status?: string         // 状态
  deptId?: number         // 部门ID
  pageNum: number         // 页码
  pageSize: number        // 每页条数
}
```
