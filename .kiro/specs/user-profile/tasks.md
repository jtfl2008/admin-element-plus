# 实现计划: 个人中心

## 概述

本实现计划将个人中心功能分解为一系列可执行的开发任务。任务按照从基础到高级的顺序组织，每个任务都包含明确的实现目标和需求引用。标记为 `*` 的任务为可选任务，可以根据项目进度决定是否实施。

## 任务列表

- [x] 1. 创建项目结构和类型定义
  - 创建个人中心相关的目录结构
  - 定义 TypeScript 类型（UserProfile、UpdateProfileParams、ChangePasswordParams、LoginLog）
  - 创建 API 接口文件
  - _需求: 数据模型_

- [x] 2. 实现 API 接口层
  - [x] 2.1 实现获取个人资料接口
    - 实现 `fetchUserProfile` 函数
    - 处理请求和响应
    - _需求: 1.1_
  
  - [x] 2.2 实现更新个人资料接口
    - 实现 `updateUserProfile` 函数
    - 处理表单数据提交
    - _需求: 2.6_
  
  - [x] 2.3 实现头像上传接口
    - 实现 `uploadAvatar` 函数
    - 处理文件上传和 FormData
    - _需求: 3.6_
  
  - [x] 2.4 实现修改密码接口
    - 实现 `changePassword` 函数
    - 处理密码数据提交
    - _需求: 4.9_
  
  - [x] 2.5 实现获取登录日志接口
    - 实现 `fetchLoginLog` 函数
    - 支持分页参数
    - _需求: 5.1_

- [ ]* 2.6 编写 API 接口单元测试
  - 测试所有 API 接口的请求和响应
  - 测试错误处理
  - _需求: 10.1, 10.2_

- [x] 3. 实现头像上传组件
  - [x] 3.1 创建头像上传组件基础结构
    - 创建 `avatar-upload.vue` 组件
    - 实现头像显示功能
    - 实现点击上传交互
    - _需求: 3.1_
  
  - [x] 3.2 实现文件验证逻辑
    - 验证文件类型（jpg、jpeg、png、gif）
    - 验证文件大小（不超过2MB）
    - 显示验证错误提示
    - _需求: 3.2, 3.3, 3.4_
  
  - [x] 3.3 实现上传功能
    - 调用上传 API
    - 显示上传进度
    - 处理上传成功和失败
    - 更新头像显示
    - _需求: 3.5, 3.6, 3.7_
  
  - [x] 3.4 实现头像预览功能
    - 选择文件后显示预览
    - 支持预览取消
    - _需求: 3.8_

- [ ]* 3.5 编写头像上传组件属性测试
  - **属性 7: 文件上传验证**
  - **验证需求: 需求 3.2, 3.3, 3.4**

- [ ]* 3.6 编写头像上传组件单元测试
  - 测试文件选择和验证
  - 测试上传流程
  - 测试错误处理
  - _需求: 3.1-3.8_


- [x] 4. 实现个人资料表单组件
  - [x] 4.1 创建个人资料表单组件基础结构
    - 创建 `basic-info-form.vue` 组件
    - 实现表单布局（只读字段和可编辑字段）
    - 实现编辑模式切换
    - _需求: 1.2, 1.3, 2.1_
  
  - [x] 4.2 实现表单验证规则
    - 配置昵称验证（必填、长度2-20）
    - 配置手机号验证（格式验证）
    - 配置邮箱验证（格式验证）
    - 实现实时验证
    - _需求: 2.3, 2.4, 2.5, 7.1, 7.2, 7.3, 7.5_
  
  - [x] 4.3 实现表单提交和取消逻辑
    - 实现保存按钮功能（验证并提交）
    - 实现取消按钮功能（恢复原始数据）
    - 处理提交成功和失败
    - 显示操作反馈
    - _需求: 2.6, 2.7, 2.8, 2.9_

- [ ]* 4.4 编写个人资料表单属性测试
  - **属性 2: 表单编辑状态切换**
  - **验证需求: 需求 2.1, 2.9**
  - **属性 3: 输入格式验证**
  - **验证需求: 需求 2.3, 2.4, 7.2, 7.3**
  - **属性 4: 必填字段验证**
  - **验证需求: 需求 2.5**
  - **属性 5: 字段长度验证**
  - **验证需求: 需求 7.1**

- [ ]* 4.5 编写个人资料表单单元测试
  - 测试表单渲染和数据绑定
  - 测试编辑模式切换
  - 测试表单验证
  - 测试提交和取消
  - _需求: 2.1-2.9_

- [x] 5. 实现密码修改表单组件
  - [x] 5.1 创建密码修改表单组件
    - 创建 `change-password-form.vue` 组件
    - 实现表单布局（旧密码、新密码、确认密码）
    - _需求: 4.1, 4.2_
  
  - [x] 5.2 实现密码验证规则
    - 配置旧密码必填验证
    - 配置新密码必填和长度验证（6-20字符）
    - 配置确认密码匹配验证
    - 配置新旧密码不能相同验证
    - _需求: 4.3, 4.4, 4.5, 4.6, 4.7, 4.8_
  
  - [x] 5.3 实现密码修改提交逻辑
    - 实现表单提交
    - 调用修改密码 API
    - 处理旧密码验证失败
    - 处理修改成功和失败
    - 显示操作反馈
    - _需求: 4.9, 4.10, 4.11, 4.12_

- [ ]* 5.4 编写密码修改表单属性测试
  - **属性 4: 必填字段验证**
  - **验证需求: 需求 4.3, 4.4**
  - **属性 5: 字段长度验证**
  - **验证需求: 需求 4.5, 4.6, 7.4**
  - **属性 6: 密码匹配验证**
  - **验证需求: 需求 4.7, 4.8**

- [ ]* 5.5 编写密码修改表单单元测试
  - 测试表单渲染
  - 测试密码验证规则
  - 测试提交流程
  - _需求: 4.1-4.12_

- [x] 6. 实现登录日志表格组件
  - [x] 6.1 创建登录日志表格组件
    - 创建 `login-log-table.vue` 组件
    - 实现表格布局和列定义
    - 显示登录时间、IP、地点、浏览器、操作系统、状态
    - _需求: 5.2_
  
  - [x] 6.2 实现日志数据加载和显示
    - 调用获取登录日志 API
    - 实现按时间倒序排列
    - 实现状态标识（成功/失败不同颜色）
    - 处理加载失败
    - _需求: 5.1, 5.3, 5.5, 5.6_
  
  - [x] 6.3 实现分页和刷新功能
    - 实现分页控件（默认每页10条）
    - 实现刷新按钮
    - _需求: 5.4, 5.7_

- [ ]* 6.4 编写登录日志表格属性测试
  - **属性 11: 登录日志排序和分页**
  - **验证需求: 需求 5.3, 5.4, 5.5**

- [ ]* 6.5 编写登录日志表格单元测试
  - 测试数据加载和显示
  - 测试排序功能
  - 测试分页功能
  - 测试刷新功能
  - _需求: 5.1-5.7_


- [x] 7. 实现用户信息头部组件
  - [x] 7.1 创建用户信息头部组件
    - 创建 `profile-header.vue` 组件
    - 显示用户头像和基本信息
    - 集成头像上传组件
    - _需求: 1.4_
  
  - [x] 7.2 实现头像更新联动
    - 头像上传成功后更新显示
    - 同步更新全局用户信息
    - _需求: 3.6_

- [ ]* 7.3 编写用户信息头部单元测试
  - 测试组件渲染
  - 测试头像更新
  - _需求: 1.4, 3.6_

- [x] 8. 实现个人中心主页面
  - [x] 8.1 创建个人中心主页面
    - 创建 `src/views/profile/index.vue` 页面
    - 实现页面布局（头部 + 标签页）
    - 实现标签页切换（基本资料、修改密码、登录日志）
    - _需求: 6.1, 6.2_
  
  - [x] 8.2 集成所有子组件
    - 集成用户信息头部组件
    - 集成个人资料表单组件
    - 集成密码修改表单组件
    - 集成登录日志表格组件
    - _需求: 1.1_
  
  - [x] 8.3 实现数据加载和状态管理
    - 页面加载时获取用户资料
    - 处理加载失败
    - 显示加载状态
    - _需求: 1.5, 9.1, 9.4_
  
  - [x] 8.4 实现页面布局和导航
    - 添加面包屑导航
    - 使用卡片组件组织内容
    - 实现响应式布局
    - _需求: 6.3, 6.4, 6.5, 6.6_

- [ ]* 8.5 编写主页面属性测试
  - **属性 1: 个人信息显示完整性**
  - **验证需求: 需求 1.2, 1.3**
  - **属性 8: 操作结果反馈**
  - **验证需求: 需求 2.7, 2.8, 3.6, 3.7, 4.11, 4.12**
  - **属性 9: API错误处理**
  - **验证需求: 需求 1.5, 5.6, 10.1, 10.2**
  - **属性 10: 加载状态显示**
  - **验证需求: 需求 3.5, 9.4, 9.5**
  - **属性 13: 响应式布局适配**
  - **验证需求: 需求 6.6**

- [ ]* 8.6 编写主页面单元测试
  - 测试页面渲染
  - 测试标签页切换
  - 测试数据加载
  - 测试错误处理
  - _需求: 1.1-1.5, 6.1-6.6_

- [x] 9. 实现路由配置
  - [x] 9.1 添加个人中心路由
    - 在路由配置中添加个人中心路由
    - 配置路由元信息（标题、图标、权限）
    - _需求: 8.3_
  
  - [x] 9.2 实现路由守卫
    - 验证用户登录状态
    - 未登录重定向到登录页
    - Token 过期处理
    - _需求: 8.4, 8.5_

- [ ]* 9.3 编写路由权限属性测试
  - **属性 12: 权限和认证验证**
  - **验证需求: 需求 8.1, 8.2, 8.3, 8.4, 8.5**

- [x] 10. 实现全局状态同步
  - [x] 10.1 更新 Pinia Store
    - 更新用户信息 Store
    - 添加更新个人资料方法
    - 添加更新头像方法
    - _需求: 2.7, 3.6_
  
  - [x] 10.2 实现全局头像同步
    - 头像上传成功后更新全局头像
    - 个人资料更新后同步全局信息
    - _需求: 3.6_

- [ ]* 10.3 编写状态管理单元测试
  - 测试 Store 状态更新
  - 测试全局同步
  - _需求: 2.7, 3.6_

- [x] 11. 实现样式和主题
  - [x] 11.1 实现组件样式
    - 编写各组件的 SCSS 样式
    - 使用 Element Plus CSS 变量
    - 实现响应式样式
    - _需求: 6.6_
  
  - [x] 11.2 优化用户体验
    - 添加过渡动画
    - 优化加载状态显示
    - 优化错误提示样式
    - _需求: 9.4, 9.5, 10.5_

- [x] 12. 检查点 - 确保所有功能正常
  - 测试个人资料查看和编辑
  - 测试头像上传
  - 测试密码修改
  - 测试登录日志查看
  - 测试响应式布局
  - 测试错误处理
  - 如有问题，请向用户反馈

- [ ]* 13. 集成测试
  - [ ]* 13.1 编写完整工作流集成测试
    - 测试页面加载到数据展示
    - 测试编辑资料完整流程
    - 测试上传头像完整流程
    - 测试修改密码完整流程
    - 测试查看登录日志
  
  - [ ]* 13.2 编写跨组件交互测试
    - 测试头像上传后资料更新
    - 测试资料修改后Store更新
    - 测试标签页切换

- [ ]* 14. 端到端测试
  - 使用 Playwright 或 Cypress 编写 E2E 测试
  - 测试完整的用户操作流程
  - 测试响应式布局

- [x] 15. 性能优化和最终检查
  - [x] 15.1 性能优化
    - 优化图片加载（懒加载）
    - 优化 API 请求（避免重复请求）
    - 优化组件渲染性能
    - _需求: 9.1, 9.2, 9.3_
  
  - [x] 15.2 最终检查
    - 检查所有需求是否实现
    - 检查代码质量和规范
    - 检查测试覆盖率
    - 检查文档完整性

## 注意事项

1. **任务执行顺序**: 按照任务编号顺序执行，确保依赖关系正确
2. **可选任务**: 标记为 `*` 的任务为可选，可根据项目进度决定是否实施
3. **测试优先**: 建议在实现功能的同时编写测试，确保代码质量
4. **增量开发**: 每完成一个任务后进行测试，确保功能正常
5. **代码审查**: 重要功能完成后进行代码审查
6. **文档更新**: 如有设计变更，及时更新设计文档
