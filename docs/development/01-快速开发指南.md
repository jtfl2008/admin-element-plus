# 快速开发指南

## 环境准备

### 1. 安装必要工具

```bash
# 安装 Node.js (>= 20.19.0)
# 访问 https://nodejs.org/ 下载安装

# 安装 pnpm (>= 10.5.0)
npm install -g pnpm

# 设置淘宝镜像（可选）
pnpm config set registry https://registry.npmmirror.com
```

### 2. 克隆项目

```bash
git clone https://gitee.com/xlsea/ruoyi-plus-soybean.git
cd ruoyi-plus-soybean
```

### 3. 安装依赖

```bash
pnpm install
```

### 4. 配置环境变量

复制 `.env.dev` 文件并根据实际情况修改：

```bash
# 后端 API 地址
VITE_SERVICE_BASE_URL=http://localhost:8080

# 其他配置...
```

### 5. 启动开发服务器

```bash
pnpm dev
```

访问 http://localhost:9527

## 快速开始

### 1. 创建新页面

#### 步骤 1: 创建页面文件

在 `src/views/` 目录下创建页面文件：

```bash
# 创建目录
mkdir -p src/views/example/demo

# 创建页面文件
touch src/views/example/demo/index.vue
```

#### 步骤 2: 编写页面组件

```vue
<script setup lang="ts">
import { ref } from 'vue';

defineOptions({
  name: 'ExampleDemo'
});

const message = ref('Hello World');
</script>

<template>
  <div class="p-4">
    <h1 class="text-2xl font-bold">{{ message }}</h1>
  </div>
</template>

<style scoped lang="scss">
// 样式
</style>
```

#### 步骤 3: 路由会自动生成

基于文件系统的路由会自动生成，无需手动配置。

路由名称: `example_demo`
路由路径: `/example/demo`

### 2. 创建 API 接口

#### 步骤 1: 定义 API 类型

在 `src/typings/api.d.ts` 中添加类型定义：

```typescript
declare namespace Api {
  namespace Example {
    /** 示例数据 */
    interface Demo {
      id: number;
      name: string;
      status: string;
    }

    /** 示例查询参数 */
    interface DemoSearchParams extends Common.CommonSearchParams {
      name?: string;
      status?: string;
    }
  }
}
```

#### 步骤 2: 创建 API 服务

在 `src/service/api/` 目录下创建 API 文件：

```typescript
// src/service/api/example.ts
import { request } from '../request';

/** 获取示例列表 */
export function fetchDemoList(params?: Api.Example.DemoSearchParams) {
  return request<Api.Example.Demo[]>({
    url: '/example/demo/list',
    method: 'get',
    params
  });
}

/** 获取示例详情 */
export function fetchDemoDetail(id: number) {
  return request<Api.Example.Demo>({
    url: `/example/demo/${id}`,
    method: 'get'
  });
}

/** 新增示例 */
export function addDemo(data: Api.Example.Demo) {
  return request({
    url: '/example/demo',
    method: 'post',
    data
  });
}

/** 更新示例 */
export function updateDemo(data: Api.Example.Demo) {
  return request({
    url: '/example/demo',
    method: 'put',
    data
  });
}

/** 删除示例 */
export function deleteDemo(id: number) {
  return request({
    url: `/example/demo/${id}`,
    method: 'delete'
  });
}
```

### 3. 使用表格组件

```vue
<script setup lang="ts">
import { ref } from 'vue';
import { useTable } from '@/hooks/common/element-table';
import { fetchDemoList, deleteDemo } from '@/service/api/example';

defineOptions({
  name: 'ExampleDemo'
});

// 表格配置
const { columns, data, loading, pagination, getData, handleQuery, handleReset } = useTable({
  apiFn: fetchDemoList,
  apiParams: {
    pageNum: 1,
    pageSize: 10
  },
  columns: () => [
    { type: 'selection', width: 55 },
    { prop: 'id', label: 'ID', width: 80 },
    { prop: 'name', label: '名称' },
    { prop: 'status', label: '状态' },
    { prop: 'createTime', label: '创建时间', width: 180 }
  ],
  immediate: true
});

// 搜索表单
const queryForm = ref({
  name: '',
  status: ''
});

// 删除
async function handleDelete(row: Api.Example.Demo) {
  await deleteDemo(row.id);
  getData();
}
</script>

<template>
  <div class="p-4">
    <!-- 搜索区域 -->
    <el-card class="mb-4">
      <el-form :model="queryForm" inline>
        <el-form-item label="名称">
          <el-input v-model="queryForm.name" placeholder="请输入名称" />
        </el-form-item>
        <el-form-item label="状态">
          <el-select v-model="queryForm.status" placeholder="请选择状态">
            <el-option label="全部" value="" />
            <el-option label="正常" value="0" />
            <el-option label="停用" value="1" />
          </el-select>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="handleQuery(queryForm)">查询</el-button>
          <el-button @click="handleReset">重置</el-button>
        </el-form-item>
      </el-form>
    </el-card>

    <!-- 表格区域 -->
    <el-card>
      <template #header>
        <div class="flex justify-between items-center">
          <span>示例列表</span>
          <el-button type="primary">新增</el-button>
        </div>
      </template>

      <el-table :data="data" :loading="loading" border>
        <el-table-column type="selection" width="55" />
        <el-table-column prop="id" label="ID" width="80" />
        <el-table-column prop="name" label="名称" />
        <el-table-column prop="status" label="状态" />
        <el-table-column prop="createTime" label="创建时间" width="180" />
        <el-table-column label="操作" width="200" fixed="right">
          <template #default="{ row }">
            <el-button type="primary" link>编辑</el-button>
            <el-button type="danger" link @click="handleDelete(row)">删除</el-button>
          </template>
        </el-table-column>
      </el-table>

      <el-pagination
        v-model:current-page="pagination.pageNum"
        v-model:page-size="pagination.pageSize"
        :total="pagination.total"
        :page-sizes="[10, 20, 50, 100]"
        layout="total, sizes, prev, pager, next, jumper"
        @size-change="getData"
        @current-change="getData"
      />
    </el-card>
  </div>
</template>
```

### 4. 使用表单组件

```vue
<script setup lang="ts">
import { ref, reactive } from 'vue';
import type { FormInstance, FormRules } from 'element-plus';
import { addDemo, updateDemo } from '@/service/api/example';

defineOptions({
  name: 'DemoForm'
});

const formRef = ref<FormInstance>();
const formData = reactive<Api.Example.Demo>({
  id: 0,
  name: '',
  status: '0'
});

// 表单验证规则
const rules: FormRules = {
  name: [
    { required: true, message: '请输入名称', trigger: 'blur' }
  ],
  status: [
    { required: true, message: '请选择状态', trigger: 'change' }
  ]
};

// 提交表单
async function handleSubmit() {
  if (!formRef.value) return;
  
  await formRef.value.validate();
  
  if (formData.id) {
    await updateDemo(formData);
  } else {
    await addDemo(formData);
  }
  
  // 关闭对话框或跳转页面
}

// 重置表单
function handleReset() {
  formRef.value?.resetFields();
}
</script>

<template>
  <el-form ref="formRef" :model="formData" :rules="rules" label-width="100px">
    <el-form-item label="名称" prop="name">
      <el-input v-model="formData.name" placeholder="请输入名称" />
    </el-form-item>
    
    <el-form-item label="状态" prop="status">
      <el-radio-group v-model="formData.status">
        <el-radio label="0">正常</el-radio>
        <el-radio label="1">停用</el-radio>
      </el-radio-group>
    </el-form-item>
    
    <el-form-item>
      <el-button type="primary" @click="handleSubmit">提交</el-button>
      <el-button @click="handleReset">重置</el-button>
    </el-form-item>
  </el-form>
</template>
```

## 开发工作流

### 1. 功能开发流程

```
1. 需求分析
   ↓
2. 设计 API 接口
   ↓
3. 定义类型
   ↓
4. 创建页面组件
   ↓
5. 实现业务逻辑
   ↓
6. 测试功能
   ↓
7. 代码审查
   ↓
8. 提交代码
```

### 2. Git 工作流

```bash
# 1. 创建功能分支
git checkout -b feature/demo-page

# 2. 开发功能
# ... 编写代码 ...

# 3. 提交代码（使用规范的提交信息）
pnpm commit
# 或
pnpm commit:zh

# 4. 推送到远程
git push origin feature/demo-page

# 5. 创建 Pull Request
```

### 3. 代码提交规范

使用约定式提交规范：

```bash
# 新功能
feat: 添加用户管理页面

# 修复 Bug
fix: 修复登录页面验证码不显示的问题

# 文档更新
docs: 更新开发指南文档

# 代码重构
refactor: 重构用户列表组件

# 性能优化
perf: 优化表格渲染性能

# 测试代码
test: 添加用户管理单元测试

# 构建或工具变动
chore: 更新依赖包版本
```

## 常用开发技巧

### 1. 使用 Hooks

#### useBoolean - 布尔值管理

```typescript
import { useBoolean } from '@sa/hooks';

const { bool: visible, setTrue: open, setFalse: close, toggle } = useBoolean(false);

// 使用
open();  // 设置为 true
close(); // 设置为 false
toggle(); // 切换状态
```

#### useLoading - 加载状态管理

```typescript
import { useLoading } from '@sa/hooks';

const { loading, startLoading, endLoading } = useLoading(false);

async function fetchData() {
  startLoading();
  try {
    await api.getData();
  } finally {
    endLoading();
  }
}
```

#### useTable - 表格管理

```typescript
import { useTable } from '@/hooks/common/element-table';

const { data, loading, pagination, getData } = useTable({
  apiFn: fetchList,
  apiParams: { pageNum: 1, pageSize: 10 },
  immediate: true
});
```

### 2. 使用字典组件

```vue
<template>
  <!-- 字典选择器 -->
  <DictSelect v-model="form.type" dict-type="sys_user_sex" />
  
  <!-- 字典标签 -->
  <DictTag :value="row.status" dict-type="sys_normal_disable" />
  
  <!-- 字典单选 -->
  <DictRadio v-model="form.status" dict-type="sys_normal_disable" />
  
  <!-- 字典复选 -->
  <DictCheckbox v-model="form.roles" dict-type="sys_user_role" />
</template>
```

### 3. 使用权限指令

```vue
<template>
  <!-- 按钮权限控制 -->
  <el-button v-hasPermi="['system:user:add']">新增</el-button>
  <el-button v-hasPermi="['system:user:edit']">编辑</el-button>
  <el-button v-hasPermi="['system:user:remove']">删除</el-button>
  
  <!-- 角色权限控制 -->
  <el-button v-hasRole="['admin']">管理员操作</el-button>
</template>
```

### 4. 国际化

```typescript
import { useI18n } from 'vue-i18n';

const { t } = useI18n();

// 使用翻译
const title = t('page.system.user.title');
const message = t('common.addSuccess');
```

```vue
<template>
  <!-- 在模板中使用 -->
  <h1>{{ $t('page.system.user.title') }}</h1>
  <el-button>{{ $t('common.add') }}</el-button>
</template>
```

### 5. 路由跳转

```typescript
import { useRouterPush } from '@/hooks/common/router';

const { routerPushByKey, routerPush } = useRouterPush();

// 通过路由名称跳转
routerPushByKey('system_user');

// 通过路由名称跳转并传参
routerPushByKey('system_user', { query: { id: '1' } });

// 通过路径跳转
routerPush('/system/user');
```

### 6. 消息提示

```typescript
// 成功提示
window.$message?.success('操作成功');

// 错误提示
window.$message?.error('操作失败');

// 警告提示
window.$message?.warning('请注意');

// 信息提示
window.$message?.info('提示信息');

// 确认对话框
window.$dialog?.warning({
  title: '警告',
  content: '确定要删除吗？',
  positiveText: '确定',
  negativeText: '取消',
  onPositiveClick: () => {
    // 确定操作
  }
});
```

## 调试技巧

### 1. Vue DevTools

安装 Vue DevTools 浏览器扩展，可以：
- 查看组件树
- 检查组件状态
- 查看 Pinia 状态
- 查看路由信息
- 性能分析

### 2. 网络请求调试

在浏览器开发者工具的 Network 面板中：
- 查看请求和响应
- 检查请求头和响应头
- 查看请求耗时
- 模拟慢速网络

### 3. 断点调试

在代码中添加 `debugger` 语句：

```typescript
async function fetchData() {
  debugger; // 代码会在这里暂停
  const data = await api.getData();
  return data;
}
```

### 4. 控制台日志

```typescript
// 普通日志
console.log('数据:', data);

// 警告日志
console.warn('警告信息');

// 错误日志
console.error('错误信息');

// 表格日志
console.table(data);

// 分组日志
console.group('用户信息');
console.log('姓名:', user.name);
console.log('年龄:', user.age);
console.groupEnd();
```

## 性能优化建议

### 1. 组件懒加载

```typescript
// 路由懒加载
const UserList = () => import('@/views/system/user/index.vue');

// 组件懒加载
const HeavyComponent = defineAsyncComponent(() => 
  import('@/components/heavy-component.vue')
);
```

### 2. 使用 v-show 代替 v-if

对于频繁切换的元素，使用 `v-show` 而不是 `v-if`：

```vue
<template>
  <!-- 频繁切换使用 v-show -->
  <div v-show="visible">内容</div>
  
  <!-- 条件渲染使用 v-if -->
  <div v-if="hasPermission">内容</div>
</template>
```

### 3. 列表使用 key

```vue
<template>
  <div v-for="item in list" :key="item.id">
    {{ item.name }}
  </div>
</template>
```

### 4. 避免在模板中使用复杂表达式

```vue
<script setup lang="ts">
// 使用计算属性
const fullName = computed(() => `${user.firstName} ${user.lastName}`);
</script>

<template>
  <!-- 好的做法 -->
  <div>{{ fullName }}</div>
  
  <!-- 避免这样做 -->
  <div>{{ user.firstName + ' ' + user.lastName }}</div>
</template>
```

### 5. 使用虚拟滚动

对于大量数据的列表，使用虚拟滚动：

```vue
<template>
  <el-table-v2
    :columns="columns"
    :data="data"
    :width="700"
    :height="400"
  />
</template>
```

## 常见问题

### 1. 端口被占用

```bash
# 修改端口
# 在 vite.config.ts 中修改 server.port
```

### 2. 依赖安装失败

```bash
# 清除缓存
pnpm store prune

# 重新安装
rm -rf node_modules
pnpm install
```

### 3. 类型错误

```bash
# 运行类型检查
pnpm typecheck
```

### 4. 代码格式问题

```bash
# 运行代码检查和修复
pnpm lint
```

## 最佳实践

### 1. 组件设计原则

- **单一职责**: 每个组件只负责一个功能
- **可复用性**: 设计通用的组件
- **可维护性**: 代码清晰，易于理解
- **性能优化**: 避免不必要的渲染

### 2. 代码组织

- 按功能模块组织代码
- 相关文件放在同一目录
- 使用有意义的命名
- 添加必要的注释

### 3. 状态管理

- 全局状态使用 Pinia
- 组件状态使用 ref/reactive
- 避免过度使用全局状态
- 合理拆分 store 模块

### 4. API 调用

- 统一的错误处理
- 请求和响应拦截
- 接口类型定义
- 合理的超时设置

### 5. 样式管理

- 使用标准 CSS 或 SCSS
- 组件样式使用 scoped
- 避免深层选择器
- 使用 CSS 变量

## 下一步

- 阅读 [项目结构说明](../architecture/02-项目结构说明.md)
- 查看 [可复用组件库](./03-可复用组件库.md)
- 学习 [API 接口规范](./04-API接口规范.md)
